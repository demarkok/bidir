\documentclass[a4,natbib=false]{article}
\usepackage{fullpage}
\usepackage{amssymb}
\usepackage{amsmath,amsfonts,amsthm}
\usepackage{xcolor}
\usepackage{mathpartir}
\usepackage{cleveref}
\usepackage{multicol}

\usepackage[colorinlistoftodos]{todonotes} 

\setlength{\columnsep}{1cm}
\let\citename\relax
\usepackage[natbib=true, abbreviate=false, dateabbrev=true, isbn=true, doi=false, urldate=comp, url=true, maxbibnames=9, maxcitenames=2, backref=false, backend=biber, style=alphabetic, language=american]{biblatex}
\addbibresource{biblio.bib}



\newtheorem{lemma}{Lemma}

%% \newcommand{\ilyam}[2][]{\todo[linecolor=red,backgroundcolor=red!25,bordercolor=red,#1]{I: #2}}
\newcommand{\ilya}[2][]{\todo[linecolor=red,backgroundcolor=red!25,bordercolor=red,inline,#1]{Ilya: #2}}
\newcommand{\ilyam}[1]{{\color{red} \texttt{Ilya:  #1}}}

%%
\newcommand{\bnfalt}{\;\;|\;\;}



% Now we give some commands to define the syntax of the language. 

\newcommand{\fun}[2]{\lambda {#1}.\,{#2}}

\newcommand{\letval}[3]{\mathsf{let}\; {#1} \,:=\, {#2} \;\mathsf{in}\; {#3}}
\newcommand{\dletval}[3]{\mathsf{dlet}\; {#1} \,:=\, {#2} \;\mathsf{in}\; {#3}}

\newcommand{\pair}[2]{\left\langle{#1}, {#2}\right\rangle}
\newcommand{\fst}[1]{\mathsf{fst}\,{#1}}
\newcommand{\snd}[1]{\mathsf{snd}\,{#1}}

\newcommand{\unit}{\langle\rangle}

\newcommand{\ctov}{\mathcal{U}}
\newcommand{\vtoc}{\mathcal{F}}

\newcommand{\unival}{\square^{v}}
\newcommand{\unicomp}{\square^{c}}
\newcommand{\comptoval}[1]{\ctov #1}
\newcommand{\valtocomp}[1]{\vtoc #1}
\newcommand{\sigmatype}[2]{\Sigma {#1}.\,#2}
\newcommand{\pitype}[2]{\Pi {#1}.\,#2}
\newcommand{\eqtype}[3]{\mathsf{eq}{#1}\,{#2}\,{#3}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\force}[1]{\mathsf{force}\,{#1}}
\newcommand{\return}[1]{\mathsf{return}\,{#1}}
\newcommand{\thunk}[1]{\mathsf{thunk}\,{#1}}

\newcommand{\recsigma}[3]{\mathsf{rec}_{\Sigma}({#1},{#2},{#3})}
\newcommand{\receq}[3]{\mathsf{rec}_{\mathsf{eq}}({#1},{#2},{#3})}

\newcommand{\subst}[3]{{#1}\{{#2}\,:=\,{#3}\}}


% This is a command to define a judgement -- we'll one command per judgement
% for delta-CBPV

\newcommand{\judge}[3]{{#1} \vdash {#2} : {#3}}
\newcommand{\judgectx}[2]{{#1} \vdash {#2}}


\newcommand{\checks}{{\color{blue} \Leftarrow}}
\newcommand{\infers}{{\color{brown} \Rightarrow}}

\newcommand{\judgec}[3]{{#1} \vdash_{c} {#2} : {#3}}
\newcommand{\judgecCheck}[3]{{#1} \vdash_{c} {#2} \, \checks \,  {#3}}
\newcommand{\judgecInfer}[3]{{#1} \vdash_{c} {#2} \, \infers \, {#3}}


\newcommand{\judgev}[3]{{#1} \vdash_{v} {#2} : {#3}}
\newcommand{\judgevCheck}[3]{{#1} \vdash_{v} {#2} \, \checks \, {#3}}
\newcommand{\judgevInfer}[3]{{#1} \vdash_{v} {#2} \, \infers \, {#3}}

\newcommand{\judgeInctx}[2]{{#1} \in {#2}}

% This is a command to define an inference rule. The optional argument to
% \inferrule* is the label for the rule. 
% 
\newcommand{\Infer}[3]{\inferrule*[right={#1}]{#2}{#3}}


\begin{document}

\section{Syntax}

\begin{mathpar}
  \begin{array}{llcl}
    \mbox{Values} & A, B, v, w & ::= & x \bnfalt \unival \bnfalt \comptoval{X}
    \bnfalt \sigmatype{x:A}{B} \bnfalt \refl \bnfalt \eqtype{A}{v}{w} \bnfalt
    \thunk{t} \bnfalt \pair{v}{w} \\[1em]

    \mbox{Computations} & X, Y, t, u & ::= & t v \bnfalt \unicomp \bnfalt
    \valtocomp{A} \bnfalt \pitype{x:A}{X} \bnfalt \force {t} \bnfalt \return{v}
    \bnfalt \fun{x:X}{t} \bnfalt \\ & & & \letval{x : A}{t}{u} \bnfalt
    \dletval{x : A}{t}{u} \bnfalt \recsigma{v}{X}{t} \bnfalt \receq{v}{X}{t}
    \\[1em]

    \mbox{Contexts} & \Gamma & ::= & \cdot \bnfalt \Gamma, x:A \\[1em]
  \end{array}
\end{mathpar}

\section{Rules}
\label{sec:rules}

\ilyam{How to make clickable references to the inference rule names?}

\subsection{Context and Equivalence}

\ilyam{Since we require the well-formedness of the context
  on the top-level, (1) I removed $\judgevCheck{\Gamma}{B}{\unival}$ from CtxExt;
  (2) I removed $\judgectx{}{\Gamma}$ from CtxInit;
  (3) I added $\judgectx{ }{\Gamma}$ to CtxI;
  (4) I added $\judgevCheck{\Gamma}{A}{\unival}$ to Let synt.}
\\ \\
\ilyam{I added $\judgevInfer{\Gamma}{\unival}{\unival}$ and
  $\judgecInfer{\Gamma}{\unicomp}{\unicomp}$ as axioms to prove Regularity.
  Is it OK? Wouldn't it lead to inconsistency? }
\\ \\
\ilyam{I removed $\judgevCheck{\Gamma}{B}{\unicomp}$ from EuivV
  and the corresponding check from EqivC because
  Otherwise $\judgevCheck{\Gamma}{\unicomp}{\unicomp}$ doesn't hold.
  Now these judgements follow from Regularity.}
\\ \\
\ilyam{In ($\Sigma$E), I made
  $\judgecCheck{\Gamma}{X}{\sigmatype{x:A}{B} \to \unicomp}$
  synthesizing and $\judgevInfer{\Gamma}{v}{\sigmatype{x:A}{B}}$ checking
  to match with ($\Pi$E). Otherwise I don't know how to prove regularity}

\begin{mathpar}
  %% \labelAxiom{Ctx0}{rule:Ctx0}
  \Infer{Ctx0}
        { }
        { \judgectx{}{\cdot}}

  \Infer{CtxI}
        { \judgevCheck{\Gamma}{A}{\unival} \\
          \judgectx{ }{\Gamma}
        }
        { \judgectx{ }{\Gamma,x:A}}
  
  \Infer{CtxExt}
        { \judgeInctx{x:A}{\Gamma} }
        { \judgeInctx{x:A}{(\Gamma, y:B)} }
  \and

  \Infer{CtxInit}
        {  }
        { \judgeInctx{x:A}{(\Gamma, x:A)} }
        \and

  \Infer{Var}
        { \judgeInctx{x:A}{\Gamma} }
        { \judgevInfer{\Gamma, x:A}{x}{A} }
        \and

  \Infer{EqivC}
        { \judgecInfer{\Gamma}{t}{Y} \\
          X \equiv Y \\
          }
        { \judgecCheck{\Gamma}{t}{X} }
  \and

  \Infer{EqivV}
        { \judgevInfer{\Gamma}{v}{B} \\
          A \equiv B \\
        }
        { \judgevCheck{\Gamma}{v}{A} }
  \and

\end{mathpar}

\subsection{Universes}
\label{sec:rules:universes}

\begin{mathpar}
  \Infer{$\vtoc$}
        { \judgevCheck{\Gamma}{A}{\unival} }
        { \judgecInfer{\Gamma}{\valtocomp{A}}{\unicomp} }
        \and

  \Infer{$\ctov$}
        { \judgecCheck{\Gamma}{X}{\unicomp} }
        { \judgevInfer{\Gamma}{\comptoval{X}}{\unival} }
  \and

  \Infer{$\Pi$}
        { \judgevCheck{\Gamma}     {A}{\unival} \\
          \judgecCheck{\Gamma, x:A}{X}{\unicomp} }
        { \judgecInfer{\Gamma}{\pitype{x:A}{X}}{\unicomp} }
  \and

  \Infer{$\Sigma$}
        { \judgevCheck{\Gamma}     {A}{\unival} \\
          \judgevCheck{\Gamma, x:A}{B}{\unival} }
        { \judgecInfer{\Gamma}{\sigmatype{x:A}{B}}{\unival} }
  \and
  

  \Infer{$\mathsf{eq}$}
        { \judgevCheck{\Gamma}{A}{\unival} \\
          \judgevCheck{\Gamma}{v}{A} \\
          \judgevCheck{\Gamma}{w}{A} }
        { \judgevInfer{\Gamma}{\eqtype{A}{v}{w}}{\unival} }
  \and

  \Infer{$\unival$}
        { }
        { \judgevInfer{\Gamma}{\unival}{\unival} }
  \and

  \Infer{$\unicomp$}
        { }
        { \judgecInfer{\Gamma}{\unicomp}{\unicomp} }
  \and


\end{mathpar}

\subsection{$\vtoc$ and $\ctov$}
\begin{mathpar}

  \Infer{$\ctov$I$\checks$}
        { \judgecCheck{\Gamma}{t}{X} }
        { \judgevCheck{\Gamma}{\thunk{t}}{\comptoval{X}}}

  \and
  \Infer{$\ctov$I$\infers$}
        { \judgecInfer{\Gamma}{t}{X} }
        { \judgevInfer{\Gamma}{\thunk{t}}{\comptoval{X}}}

  \and

  \Infer{$\ctov$E$\checks$}
        { \judgevCheck{\Gamma}{v}{\comptoval{X}} }
        { \judgecCheck{\Gamma}{\force{v}}{X}}

  \and
  \Infer{$\vtoc$E$\infers$}
        { \judgevInfer{\Gamma}{v}{\comptoval{X}} }
        { \judgecInfer{\Gamma}{\force{v}}{X}}
  \and


  \Infer{$\vtoc$I$\checks$}
        { \judgevCheck{\Gamma}{v}{A} }
        { \judgecCheck{\Gamma}{\return{v}}{\valtocomp{A}}}
  \and

  \Infer{$\vtoc$I$\infers$}
        { \judgevInfer{\Gamma}{v}{A} }
        { \judgecInfer{\Gamma}{\return{v}}{\valtocomp{A}}}
  \and
\end{mathpar}

\subsection{Let and Dependent Let}

\begin{mathpar}
  \Infer{Let$\infers$}
        {
          \judgecInfer{\Gamma, x : A}{u}{X} \\
          \judgecCheck{\Gamma}{t}{\valtocomp{A}} \\
          \judgecCheck{\Gamma}{X}{\unicomp} \\ 
          \judgevCheck{\Gamma}{A}{\unival} \\ 
        }
        { \judgecInfer{\Gamma}{\letval{x : A}{t}{u}}{X} }
  \and
  \Infer{Let$\checks$}
        { \judgecCheck{\Gamma}{t}{\valtocomp{A}} \\ 
          \judgecCheck{\Gamma}{X}{\unicomp} \\ 
          \judgecCheck{\Gamma, x : A}{u}{X}}
        { \judgecCheck{\Gamma}{\letval{x : A}{t}{u}}{X} }
  \and

  \Infer{DLet$\infers$}
        {
          \judgecInfer{\Gamma, x:A}{u}{X} \\
          \judgecCheck{\Gamma}{t}{\valtocomp{A}} \\
          \judgecCheck{\Gamma, x:A}{X}{\unicomp} \\ 
        }
        { \judgecInfer{\Gamma}{\dletval{x:A}{t}{u}}{(\letval{x:A}{t}{X})} }
  \and
  \Infer{DLet$\checks$}
        { \judgecCheck{\Gamma}{t}{\valtocomp{A}} \\ 
          \judgecCheck{\Gamma, x:A}{X}{\unicomp} \\ 
          \judgecCheck{\Gamma, x:A}{u}{X}}
        { \judgecCheck{\Gamma}{\dletval{x:A}{t}{u}}{(\letval{x:A}{t}{X})} }
  \and

\end{mathpar}

\subsection{$\Pi$ and $\Sigma$}

\begin{mathpar}

  %% \Infer{$\Pi$I$\infers$}
  %%       { \judgecCheck{\Gamma, x:A}{X}{\unicomp} \\
  %%         \judgecInfer{\Gamma, x:A}{t}{X} }
  %%       { \judgecInfer{\Gamma}{\fun{x:A}{t}}{\pitype{x:A}{X}} }
  %% \and

  \Infer{$\Pi$I$\checks$}
        { \judgecCheck{\Gamma, x:A}{X}{\unicomp} \\
          \judgecCheck{\Gamma, x:A}{t}{X} }
        { \judgecCheck{\Gamma}{\fun{x:A}{t}}{\pitype{x:A}{X}} }
  \and

  \Infer{$\Pi$E}
        { \judgecInfer{\Gamma}{t}{\pitype{x:A}{X}} \\
          \judgevCheck{\Gamma}{v}{A} }
        { \judgecInfer{\Gamma}{t\,v}{\subst{X}{x}{v}} }
  \and

  %% \Infer{$\Sigma$I$\infers$}
  %%       { \judgevInfer{\Gamma}{v}{A} \\
  %%         \judgevInfer{\Gamma}{w}{B} \\
  %%         \judgevCheck{\Gamma}{A}{\unival} \\
  %%         \judgevCheck{\Gamma}{B}{\unival} }
  %%       { \judgevInfer{\Gamma}{\pair{v}{w}}{A \times B}}
  %% \and

  \Infer{$\Sigma$I$\checks$}
        { \judgevCheck{\Gamma}{v}{A} \\
          \judgevCheck{\Gamma}{w}{\subst{B}{x}{v}} \\
          \judgevCheck{\Gamma}{\sigmatype{x:A}{B}}{\unival} }
        { \judgevCheck{\Gamma}{\pair{v}{w}}{\sigmatype{x:A}{B}} }
   \and


  \Infer{$\Sigma$E}
        {
          \judgecInfer{\Gamma}{X}{\sigmatype{x:A}{B} \to \unicomp} \\
          \judgevCheck{\Gamma}{v}{\sigmatype{x:A}{B}} \\
          \judgecCheck{\Gamma}{t}{\pitype{(x:A)(y:B)}{X \pair{x}{y}}}}
        { \judgecInfer{\Gamma}{\recsigma{v}{X}{t}}{X\,v} }
  \and

\end{mathpar}

\subsection{Equality}

\begin{mathpar}

  \Infer{$\mathsf{eq}$I}
        { \judgevCheck{\Gamma}{A}{\unival} \\
          \judgevCheck{\Gamma}{v}{A}}
        { \judgevCheck{\Gamma}{\refl}{\eqtype{A}{v}{v}} }

  \and

  \Infer{$\mathsf{eq}$E$\infers$}
        { \judgevInfer{\Gamma}{v}{\eqtype{A}{w_1}{w_2}} \\
          \judgecCheck{\Gamma}{X}{\pitype{y:A}{\eqtype{A}{w_1}{y} \to \unicomp}} \\
          \judgecCheck{\Gamma}{t}{X\,w_1\,\refl} }
        { \judgecInfer{\Gamma}{\receq{v}{X}{t}}{X\,w_2\,v} }
  \and

  %% \Infer{$\mathsf{eq}$E$\checks$}
  %%       { \judgevCheck{\Gamma}{v}{\eqtype{A}{w_1}{w_2}} \\
  %%         \judgecInfer{\Gamma}{X}{\pitype{y:A}{\eqtype{A}{w_1}{y} \to \unicomp}} \\
  %%         \judgecCheck{\Gamma}{t}{X\,w_1\,\refl} }
  %%       { \judgecCheck{\Gamma}{\receq{v}{X}{t}}{X\,w_2\,v} }
  %%       \and

\end{mathpar}

\section{Properties}
%% \subsection{Mode-correctness}
%% \subsection{Regularity}

\begin{lemma}[Mode-correctness]
  Each rule in \cref{sec:rules} is mode-correct. Specifically, as defined in \cite{dunfield2021:bidirectional},
  \begin{enumerate}
    \item The premises are mode-correct: for each premise, every input meta-variable is known from the input of the rule's conclusion and the outputs of the earlier premises.
    \item The conclusion is mode-correct: if all premises have been derived, the outputs of the conclusion are known.
  \end{enumerate}
\end{lemma}
\begin{proof}
  First, we prove the mode-correctness of \emph{conclusion} for each rule.
  Note that it is only relevant for the \emph{synthesizing} rules, because for the \emph{checking} rules, the resulting type is given as an input.

  \begin{multicols}{2}
  \begin{itemize}
  \item[(Var)]
    $A$ is known from the input of the conclusion.
  \item[(Universes)]
    For rules in \cref{sec:rules:universes} ($\ctov$, $\vtoc$, $\Pi$,
    $\Sigma$, $\mathsf{eq}$), the resulting type (a universe) is the only
    possible option.

  \item[($\ctov$I$\infers$)]
    $X$ is known from the output of $\judgecInfer{\Gamma}{t}{X}$.

  \item[($\vtoc$E$\infers$)]
    $X$ is known from the output of $\judgevInfer{\Gamma}{v}{\comptoval{X}}$.

  \item[($\vtoc$I$\infers$)]
    $A$ is known from the output of $\judgevInfer{\Gamma}{v}{\comptoval{X}}$.

  \item[(Let$\infers$)]
    $X$ is known from the output of $\judgecInfer{\Gamma, x : A}{u}{X}$.

  \item[(DLet$\infers$)]
    $x$, $A$, and $t$ are given in the input of the conclusion; $X$ is known
    from the output of $\judgecInfer{\Gamma, x:A}{u}{X}$.

  \item[($\Pi$E)]
    $v$ is given in the input of the conclusion; $x$ and $X$ are known from the
    output of $\judgecInfer{\Gamma}{t}{\pitype{x:A}{X}}$.

  \item[($\Sigma$E)]
    $X$ and $v$ are given in the input of the conclusion.

  \item[($\mathsf{eq}$E$\infers$)]
    $X$ and $v$ are given in the input of the conclusion;
    $w_2$ is known from the output of $\judgevInfer{\Gamma}{v}{\eqtype{A}{w_1}{w_2}}$.
  \end{itemize}
  \end{multicols}

  Second, we let us show the mode-correctness of \emph{premises}.
  
  \newcommand{\fromconcl}{given in the input of the conclusion}

  \begin{multicols}{2}
  \begin{itemize}
      \item[(Ctx0)]
        There are no premises.

      \item[(CtxI)]
        $\Gamma$ and $A$ are \fromconcl.

      \item[(CtxExt)]
        $X$, $A$, and $\Gamma$ are \fromconcl.

      \item[(CtxInit)]
        There are no premises. 

      \item[(Var)]
        $x$, $A$, and $\Gamma$ are \fromconcl.

      \item[(EqivC)]
        $\Gamma$, $t$, and $X$ are \fromconcl;
        $Y$ is known from the output of $\judgecInfer{\Gamma}{t}{Y}$.

      \item[(EqivV)]
        $\Gamma$, $v$, and $A$ are \fromconcl;
        $B$ is known from the output of $\judgevInfer{\Gamma}{v}{B}$.

      \item[($\vtoc$)]
        $\Gamma$ and $A$ are \fromconcl.

      \item[($\ctov$)]
        $\Gamma$ and $X$ are \fromconcl.

      \item[($\Pi$)]
        $\Gamma$, $A$, $x$, and $X$ are \fromconcl.

      \item[($\Sigma$)]
        $\Gamma$, $A$, $x$, and $B$ are \fromconcl.

      \item[($\mathsf{eq}$)]
        $\Gamma$, $A$, $v$, and $w$ are \fromconcl.

      \item[($\unival$ and $\unicomp$)]
        There are no premises.

      \item[($\ctov$I$\checks$)]
        $\Gamma$, $t$, and $X$ are \fromconcl.

      \item[($\ctov$I$\infers$)]
        $\Gamma$ and $t$ are \fromconcl.

      \item[($\ctov$E$\checks$)]
        $\Gamma$, $v$, and $X$ are \fromconcl.

      \item[($\vtoc$E$\infers$)]
        $\Gamma$ and $v$ are \fromconcl.

      \item[($\vtoc$I$\checks$)]
        $\Gamma$, $v$, and $A$ are \fromconcl.

      \item[($\vtoc$I$\infers$)]
        $\Gamma$ and $v$ are \fromconcl.

      \item[(Let$\infers$)]
        $\Gamma$, $x$, $A$, $u$, and $t$ are \fromconcl;
        $X$ is known from the output of $\judgecInfer{\Gamma, x : A}{u}{X}$.
        
      \item[(Let$\checks$)]
        $\Gamma$, $t$, $A$, $X$, $x$, and $u$ are \fromconcl.

      \item[(DLet$\infers$)]
        $\Gamma$, $x$, $A$, $u$, and $t$ are \fromconcl.
        $X$ is known from the output of $\judgecInfer{\Gamma, x:A}{u}{X}$.

      \item[(DLet$\checks$)]
        $\Gamma$, $t$, $A$, $x$, $X$, and $u$ are \fromconcl.

      \item[($\Pi$I$\checks$)]
        $\Gamma$, $x$, $A$, $X$, and $t$ are \fromconcl.

      \item[($\Pi$E)]
        $\Gamma$, $t$, and $v$ are \fromconcl;
        $A$ is known from the output of $\judgecInfer{\Gamma}{t}{\pitype{x:A}{X}}$

      \item[($\Sigma$I$\checks$)]
        $\Gamma$, $v$, $A$, $w$, $B$, $x$ are \fromconcl.

      \item[($\Sigma$E)]
        $\Gamma$, $X$, and $v$, are \fromconcl;
        $x$, $A$, and $B$ are known from the output of
        $\judgecInfer{\Gamma}{X}{\sigmatype{x:A}{B} \to \unicomp}$;
        $y$ is an arbitrary fresh variable.
        
      \item[($\mathsf{eq}$I)]
        $\Gamma$, $A$, and $v$ are \fromconcl.

      \item[($\mathsf{eq}$E$\infers$)]
        $\Gamma$, $v$, $X$, and $t$ are \fromconcl;
        $A$ and $w_1$ are known from the output of $\judgevInfer{\Gamma}{v}{\eqtype{A}{w_1}{w_2}}$.
  \end{itemize}
  \end{multicols}


\end{proof}

\begin{lemma}[Context Soundness]
  \label{lemma:ctx-soundness}
  If $\judgeInctx{x:A}{\Gamma}$ and $\judgectx{}{\Gamma}$ then $\judgevCheck{\Gamma}{A}{\unival}$
\end{lemma}
\begin{proof}
  \ilyam{By trivial induction on $\judgeInctx{x:A}{\Gamma}$}
\end{proof}

\begin{lemma}[Regularity]
  The types synthesized by $\infers$ are well-formed. Specifically, the following properties hold
  \begin{enumerate}
  \item if $\judgectx{}{\Gamma}$ and $\judgevInfer{\Gamma}{v}{A}$ then $\judgevCheck{\Gamma}{A}{\unival}$
  \item if $\judgectx{}{\Gamma}$ and $\judgecInfer{\Gamma}{t}{X}$ then $\judgevCheck{\Gamma}{X}{\unicomp}$
  \end{enumerate}
\end{lemma}

\begin{proof}
  We prove this property by mutual structural induction on
  $\judgevInfer{\Gamma}{v}{A}$ and 
  $\judgecInfer{\Gamma}{t}{X}$.
  Let us consider the synthesizing rules.
  \begin{itemize}
  \item[(Var)]
    Since $(x : A)$ belongs to a \emph{well-formed} context $\Gamma$, 
    the property we need
    ($\judgevCheck{\Gamma}{A}{\unival}$) holds by \cref{lemma:ctx-soundness}.
  \item[(Universes)]
    Each rule in \cref{sec:rules:universes} synthesizes either $\unival$ or $\unicomp$.
    The desired properties hold by the following derivation trees:
    \begin{mathpar}
      \Infer{EqivV}
            {\Infer{$\unival$}
                    { }
                    { \judgevInfer{\Gamma}{\unival}{\unival} }\\
              \unival \equiv \unival \\
            }
            { \judgevCheck{\Gamma}{\unival}{\unival} }
      \and
      \Infer{EqivC}
            {\Infer{$\unicomp$}
              { }
              { \judgecInfer{\Gamma}{\unicomp}{\unicomp} }\\
              \unicomp \equiv \unicomp \\
            }
            { \judgecCheck{\Gamma}{\unicomp}{\unicomp} }

     \end{mathpar}
  \item[($\ctov$I$\infers$ and $\vtoc$I$\infers$)]
    The following derivation trees prove the required properties,
    where $\dag$ and $\ddag$ are derived from the inductive hypotheses.
    \begin{mathpar}
      \Infer{EqivC}
            {\Infer{$\ctov$}
              { \Infer{}{\dag}{\judgecCheck{\Gamma}{X}{\unicomp}} }
              { \judgevInfer{\Gamma}{\comptoval{X}}{\unival} } \\
              \comptoval{X} \equiv \comptoval{X} \\
            }
            { \judgevCheck{\Gamma}{\comptoval{X}}{\unival} }
      \and

      \Infer{EqivV}
            {\Infer{$\vtoc$}
              { \Infer{}{\ddag}{\judgevCheck{\Gamma}{A}{\unival}} }
              { \judgecInfer{\Gamma}{\valtocomp{A}}{\unicomp} } \\
              \valtocomp{A} \equiv \valtocomp{A} \\
            }
            { \judgecCheck{\Gamma}{\valtocomp{A}}{\unicomp} }

    \end{mathpar}
     
  \item[($\vtoc$E$\infers$)]
    \ilyam{Depends on $\unival \equiv \cdot$ }
  \item[(Let$\infers$)]
    The desired property is in the premises.
  \item[(DLet$\infers$)]
    The following derivation tree proves the required property.
    $\judgecCheck{\Gamma}{t}{\valtocomp{A}}$ and 
    $\judgecInfer{\Gamma, x : A}{u}{\unicomp}$ are given as premises.
  \begin{mathpar}
    \Infer{Let$\checks$}
          { \judgecCheck{\Gamma}{t}{\valtocomp{A}} \\ 
            \Infer{ }{\Infer{$\unicomp$}{ }{\judgecInfer{\Gamma}{\unicomp}{\unicomp}}}
                     {\judgecCheck{\Gamma}{\unicomp}{\unicomp}} \\ 
            \Infer{ }{\judgecInfer{\Gamma, x : A}{u}{\unicomp}}
                     {\judgecCheck{\Gamma, x : A}{u}{\unicomp}}}
          { \judgecCheck{\Gamma}{\letval{x : A}{t}{u}}{\unicomp} }
          \and
  \end{mathpar}

\item[($\Pi$E)]
  \ilyam{Depends on $\equiv$ and requires the substitution lemma}
\item[($\Sigma$E)]
  By applying ($\Pi$E) to the first two premises. 

\item[($\mathsf{eq}$E$\infers$)]
  \ilyam{The same trick as in ($\Sigma$E) doesn't work...}

\end{itemize}


\end{proof}

\printbibliography

\end{document}
